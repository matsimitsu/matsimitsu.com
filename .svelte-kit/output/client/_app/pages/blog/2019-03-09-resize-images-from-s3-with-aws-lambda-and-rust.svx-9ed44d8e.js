import{S as a,i as n,s,A as e,j as t,m as o,o as p,p as c,v as r,r as i,w as l,q as u,e as h,t as d,k as m,c as k,a as f,g,d as w,n as v,b,f as y,E,G as S}from"../../chunks/vendor-f5a3c274.js";import{M as A}from"../../chunks/_mdsvex-0fbf9182.js";import{R as z}from"../../chunks/ResponsiveImage-8c4fb22f.js";import"../../chunks/stores-0da78aa4.js";import"../../chunks/FormattedDate-b4a44e35.js";function I(a){let n,s,e,c,u,A,I,C,P,L,_,T,W,R,x,O,j,$,D,N,M,H,q,F,G,J,B,U,Y,V,K,Z,Q,X,aa,na,sa,ea,ta,oa,pa,ca,ra,ia,la,ua,ha,da,ma,ka,fa,ga,wa,va,ba,ya,Ea,Sa,Aa,za,Ia,Ca,Pa,La,_a,Ta,Wa,Ra,xa,Oa,ja,$a,Da,Na,Ma,Ha,qa,Fa,Ga,Ja,Ba,Ua,Ya,Va,Ka,Za,Qa,Xa,an,nn,sn,en,tn,on,pn,cn,rn,ln,un,hn,dn,mn,kn,fn,gn,wn,vn,bn,yn,En,Sn,An,zn,In,Cn,Pn,Ln,_n,Tn,Wn,Rn,xn,On,jn,$n,Dn,Nn,Mn,Hn,qn,Fn,Gn,Jn,Bn,Un,Yn,Vn,Kn,Zn,Qn,Xn,as,ns,ss,es,ts,os,ps,cs,rs,is,ls,us,hs,ds,ms,ks,fs,gs,ws,vs,bs,ys,Es,Ss,As,zs,Is,Cs,Ps,Ls,_s,Ts,Ws,Rs,xs,Os,js,$s,Ds,Ns,Ms,Hs,qs,Fs,Gs,Js,Bs,Us,Ys,Vs,Ks,Zs,Qs,Xs,ae,ne,se,ee,te,oe,pe,ce,re,ie,le,ue,he,de,me,ke,fe,ge,we,ve,be,ye,Ee,Se,Ae,ze,Ie,Ce,Pe,Le,_e,Te,We,Re,xe,Oe,je,$e,De,Ne,Me,He,qe,Fe,Ge,Je,Be,Ue,Ye,Ve,Ke,Ze,Qe,Xe,at,nt,st,et,tt,ot,pt,ct,rt,it,lt,ut,ht,dt,mt,kt,ft,gt,wt,vt,bt,yt,Et,St,At,zt,It,Ct,Pt,Lt,_t,Tt,Wt,Rt,xt,Ot,jt,$t,Dt,Nt,Mt,Ht,qt,Ft,Gt,Jt,Bt,Ut,Yt,Vt,Kt,Zt,Qt,Xt,ao,no,so,eo,to,oo,po,co,ro,io,lo,uo,ho,mo,ko,fo,go,wo,vo,bo,yo,Eo,So,Ao,zo,Io,Co,Po,Lo,_o,To,Wo,Ro,xo,Oo,jo,$o,Do,No,Mo,Ho,qo,Fo,Go,Jo,Bo,Uo,Yo,Vo,Ko,Zo,Qo,Xo,ap,np,sp,ep,tp,op,pp,cp,rp,ip,lp,up,hp,dp,mp,kp,fp,gp,wp,vp,bp,yp;return Pt=new z({props:{src:"https://cdn.matsimitsu.com/blog/image-resize-rust/iam-role.jpg",width:"1367",height:"1529",alt:"Screenshot of AWS IAM page"}}),Jt=new z({props:{src:"https://cdn.matsimitsu.com/blog/image-resize-rust/lambda-config-options.jpg",width:"1295",height:"1412",alt:"Screenshot of AWS Lambda config options"}}),so=new z({props:{src:"https://cdn.matsimitsu.com/blog/image-resize-rust/lambda-s3-config.jpg",width:"1303",height:"1194",alt:"Screenshot of AWS Lambda s3 config"}}),{c(){n=h("p"),s=d("The very first iteration of my site didn’t have resized images and always showed the full 2200 pixels wide images, this was great on my local (desktop) machine, but when I tried visiting the site in a hotel in Cambodia, the site took ages to load."),e=m(),c=h("p"),u=d("Resizing the images locally worked fine, but took a lot of time and uploading an image in five different sizes on slow Wi-Fi took ages, if it worked at all."),A=m(),I=h("p"),C=d("I then switched to using an image resize proxy that took images from disk and re-sized them on the fly, caching the result in Nginx. This worked okay, but there was a tradeoff between server specs and monthly cost. Low specs meant that on an uncached page it took minutes before all images were resized, while high specs meant high monthly cost for a server that was idle 99% of the time."),P=m(),L=h("p"),_=d("The solution to not running a server was switching to "),T=h("a"),W=d("imgix"),R=d(", it’s a great service that resizes images for you and does so with good quality and speed, but there’s a minimum fee of $10,00 a month, wether you use the service or not, and the costs go up pretty quickly as you add more and more photos. This is in addition to the S3 storage costs that imgix uses as the source for its proxy."),x=m(),O=h("p"),j=d("This lead me to the latest solution, use S3 to store the images (imgix also requires s3 as a source, so the images were already there) and AWS Lambda to resize the images on upload."),$=m(),D=h("p"),N=d("This means I only have to upload an image once and Lambda will take care of all the resized variants. I found a few (Javascript) solutions, and "),M=h("a"),H=d("aws-lambda-image"),q=d(" looked the easiest to use. This ran for a few months, before I decided to roll my own solution for a few reasons."),F=m(),G=h("p"),J=d("aws-lambda-image does a lot of magic and uses "),B=h("a"),U=d("Claudia"),Y=d(" to manage the Lambda settings. While it works great, I don’t really like tools that require high-level access to AWS API’s and configure a lot for you automatically. I have no idea what’s happening after running the commands."),V=m(),K=h("p"),Z=d("Another risk for me is that it Runs on Node, which eventually will require an upgrade at some point, which has a high risk of breaking the function and these things always happen at the most inconvenient times."),Q=m(),X=h("p"),aa=d("What I wanted is a single binary that just keeps working and requires no upkeep, configured by myself so I know what’s happening and ideally more efficient than the NodeJS solution. It’s also a great excuse to play with Rust some more and the just released "),na=h("a"),sa=d("Rust AWS Lambda Runtime"),ea=d("."),ta=m(),oa=h("h2"),pa=h("a"),ca=d("The goal"),ra=m(),ia=h("p"),la=d("I wanted something similar to the Javascript solution used. It should listen to events emitted when a file is uploaded to S3 and resize the image in several widths ("),ua=h("code"),ha=d("360px"),da=d(", "),ma=h("code"),ka=d("720px"),fa=d(", "),ga=h("code"),wa=d("1200px"),va=d(" and "),ba=h("code"),ya=d("2200px"),Ea=d(")."),Sa=m(),Aa=h("p"),za=d("Before we start, you can follow along with the complete source on "),Ia=h("a"),Ca=d("GitHub"),Pa=m(),La=h("h3"),_a=h("a"),Ta=d("A binary project"),Wa=m(),Ra=h("p"),xa=d("Lets start by making a new Rust project, it should be a binary project and we need to make a few tweaks to the Cargo TOML to make sure Lambda can run the binary."),Oa=m(),ja=h("pre"),$a=m(),Da=h("p"),Na=d("The way AWS Lambda works is that it starts the app/binary for you and then you have to call a certain endpoint from the app to receive new jobs to process. The "),Ma=h("code"),Ha=d("lambda_runtime"),qa=d(" crate abstracts this process away and all you have to do is implement an event handler that will be called with the "),Fa=h("code"),Ga=d("lambda!"),Ja=d(" call."),Ba=m(),Ua=h("p"),Ya=d("Cargo (heh) culting from the example app, we start a logger and run the lambda for the AWS Runtime."),Va=m(),Ka=h("pre"),Za=m(),Qa=h("p"),Xa=d("The "),an=h("code"),nn=d("handle_event"),sn=d(" function will be called with the JSON result from the endpoint the runtime has called for us. Let’s convert this into a nice struct with Serde, by using the "),en=h("a"),tn=d("AWS-lambda-events crate"),on=d("."),pn=m(),cn=h("h3"),rn=h("a"),ln=d("Handle S3 events"),un=m(),hn=h("p"),dn=d("This event contains one or more “records” that represent the S3 uploads it has received."),mn=m(),kn=h("pre"),fn=m(),gn=h("p"),wn=d("For each upload we have to get the file from S3, convert the file to one or more image variations and upload those back to S3 again. There are a couple of crates that implement the S3 API, I went with "),vn=h("a"),bn=d("rust-s3"),yn=d(" as it looked simple and small."),En=m(),Sn=h("p"),An=d("AWS Lambda sets a couple of "),zn=h("a"),In=d("default ENV vars"),Cn=d(", among those it sets "),Pn=h("code"),Ln=d("AWS_ACCESS_KEY_ID"),_n=d(" and "),Tn=h("code"),Wn=d("AWS_SECRET_ACCESS_KEY"),Rn=d(", the "),xn=h("code"),On=d("rust-s3"),jn=d(" crate can detect those with the "),$n=h("code"),Dn=d("Credentials::default()"),Nn=d(" function."),Mn=m(),Hn=h("p"),qn=d("In my case I want to store the images in the same bucket as the source, just in a different location, so I can use the information from the S3 event to determine the region and bucket."),Fn=m(),Gn=h("pre"),Jn=m(),Bn=h("h3"),Un=h("a"),Yn=d("Recursion"),Vn=m(),Kn=h("p"),Zn=d("Now that we have all the required configuration to get and store images on S3, we have to do a sanity check first. We listen to an S3 event for uploaded images, but this function also uploads images to S3, this means that if you make a mistake in the configuration, it could send out an S3 event for each file you put back into the bucket."),Qn=m(),Xn=h("p"),as=d("This can mean that you’ll process your own (resized) images again, and since we generate more than one variant for each uploaded image. Combined with the power of Lambda and it’s concurrency, it can mean that you’ll quickly generate thousands of new Lambda tasks, forcing you to hit the dreaded “panic button” in the Lambda UI, before you rack up an enormous AWS bill. (This "),ns=h("em"),ss=d("may"),es=d(" or may not come from my own experience ;))."),ts=m(),os=h("p"),ps=d("After resizing the image, we’ll append "),cs=h("code"),rs=d("-<size>"),is=d(" to the filename (e.g. "),ls=h("code"),us=d("foo.jpg"),hs=d(" becomes "),ds=h("code"),ms=d("foo-360.jpg"),ks=d("). To prevent this Lambda recursion we check the uploaded filename to see if it was already resized."),fs=m(),gs=h("pre"),ws=m(),vs=h("h3"),bs=h("a"),ys=d("Get images from- and upload to S3"),Es=m(),Ss=h("p"),As=d("Now that we know for sure we have the right image, let’s fetch it from S3 and load it from memory into the "),zs=h("code"),Is=d("image"),Cs=d(" crate."),Ps=m(),Ls=h("pre"),_s=m(),Ts=h("h3"),Ws=h("a"),Rs=d("Resize the images"),xs=m(),Os=h("p"),js=d("With the image in memory we can resize it. Depending on the memory you give a Lambda function, you can get one or more CPU cores to your disposal. To get the maximum from our billed execution time, I opted to use the great "),$s=h("a"),Ds=d("rayon-rs"),Ns=d(" crate to execute the resizes in parallel. All you have to do to process the image in parallel is to replace "),Ms=h("code"),Hs=d("iter()"),qs=d(" with "),Fs=h("code"),Gs=d(".par_iter()"),Js=d(", awesome!"),Bs=m(),Us=h("pre"),Ys=m(),Vs=h("p"),Ks=d("Another thing we do is loop through "),Zs=h("code"),Qs=d("&config.replacemens"),Xs=d(", this is another feature to combat the recursion problem we have, by allowing us to replace certain parts of the (input) path of a file."),ae=m(),ne=h("p"),se=d("We can set a "),ee=h("code"),te=d("REPLACEMENTS"),oe=d(" env var with key/value strings, such as "),pe=h("code"),ce=d('"original:resized"'),re=d("."),ie=m(),le=h("p"),ue=d("With an input path of "),he=h("code"),de=d("/original/trips/asia2018/img_01.jpg"),me=d(" this will be converted to "),ke=h("code"),fe=d("/resized/trips/asia2018/img_01.jpg"),ge=d(". Combined with the input filter on the AWS Lambda configure page you can make sure converted images are never processed twice."),we=m(),ve=h("p"),be=d("Finally we need to implement the actual resize function called in the code above."),ye=m(),Ee=h("p"),Se=d("it takes the image and a new width, calculates the ratio and generates the new needed height. We then call the image crate function and use the "),Ae=h("code"),ze=d("ImageOutputFormat::JPEG(90)"),Ie=d(" ENUM to set the JPEG quality to "),Ce=h("code"),Pe=d("90"),Le=d(" (from the default "),_e=h("code"),Te=d("75"),We=d(")."),Re=m(),xe=h("pre"),Oe=m(),je=h("p"),$e=d("You can find the complete project on "),De=h("a"),Ne=d("GitHub"),Me=d("."),He=m(),qe=h("h3"),Fe=h("a"),Ge=d("Compiling for AWS Lambda"),Je=m(),Be=h("p"),Ue=d("With a working binary we now need to (cross)compile it for the right environment/distribution. Luckily a person named "),Ye=h("a"),Ve=d("softprops"),Ke=d(" created a "),Ze=h("a"),Qe=d("docker container"),Xe=d(" that has all the tools we need to compile this binary to be used with the Lambda image."),at=m(),nt=h("pre"),st=m(),et=h("p"),tt=d("This will generate a "),ot=h("code"),pt=d("bootstrap.zip"),ct=d(" file in "),rt=h("code"),it=d("target/lambda/release"),lt=d(". You can also get the "),ut=h("code"),ht=d("bootstrap.zip"),dt=d(" from te "),mt=h("a"),kt=d("releases page"),ft=d("."),gt=m(),wt=h("h3"),vt=h("a"),bt=d("Configuring Lambda"),yt=m(),Et=h("p"),St=d("With a freshly compiled binary, we’re nearly there. We need to do two things, configure a IAM role that allows the Lambda function to write logs and has access to the S3 bucket and configure the Lambda function itself."),At=m(),zt=h("p"),It=d("Let’s start with the IAM Role, we’ll have to add two policies, one that allows the function to log and one that allows access to S3, it should look something like:"),Ct=m(),t(Pt.$$.fragment),Lt=m(),_t=h("p"),Tt=d("Bonus points if you lock the S3 role down a bit more, by not allowing it to remove items."),Wt=m(),Rt=h("p"),xt=d("With a role configured, we can configure the lambda function, we have to set the "),Ot=h("code"),jt=d("SIZES"),$t=d(" and "),Dt=h("code"),Nt=d("REPLACEMENTS"),Mt=d(" ENV vars and I found that the function works best with at least "),Ht=h("code"),qt=d("1024MB"),Ft=d(" of memory assigned."),Gt=m(),t(Jt.$$.fragment),Bt=m(),Ut=h("p"),Yt=d("Attach the generated "),Vt=h("code"),Kt=d("bootstrap.zip"),Zt=d(" file and save the function."),Qt=m(),Xt=h("p"),ao=d("Finally we need to configure the S3 events, pick “S3” events from the “Add triggers” section on the page and pick the option that says “All upload events”. I’ve also set the prefix/suffix option to prevent our recursion problem."),no=m(),t(so.$$.fragment),eo=m(),to=h("p"),oo=d("Save the function again and upload an image to test, if everything went well, it should generate resized images after the upload is complete. You can verify it works (or catch any errors) on AWS Cloudwatch, it should look something like this:"),po=m(),co=h("pre"),ro=m(),io=h("h2"),lo=h("a"),uo=d("Future goals"),ho=m(),mo=h("p"),ko=d("You can find the source on "),fo=h("a"),go=d("GitHub"),wo=d(" and a ready-to-go "),vo=h("code"),bo=d("bootstrap.zip"),yo=d(" on the "),Eo=h("a"),So=d("relase page"),Ao=d("."),zo=m(),Io=h("p"),Co=d("The binary works great and has resized many images already. With Amazon’s generous free Lambda tier, resizing all the images on my blog has cost me a grand total of "),Po=h("strong"),Lo=d("$0.61"),_o=d(". There is room for improvement, however. Error handling can be a lot nicer than "),To=h("code"),Wo=d(".expect()"),Ro=d(" everywhere, though as long as it logs the error in CloudWatch it works for me right now."),xo=m(),Oo=h("p"),jo=d("It would be nice if it could handle more image formats, while the "),$o=h("code"),Do=d("image"),No=d(" crate works fine with input formats such as GIF, JPEG, PNG and WEBP, right now I only generate JPEG images. I like it to generate WEBP images along side the JPEGs but I couldn’t find any crate that can generate WEBP images. If you happen to know one or have other feedback on this post, please let me know "),Mo=h("a"),Ho=d("by email"),qo=d(" or "),Fo=h("a"),Go=d("tweet me"),Jo=d("."),Bo=m(),Uo=h("h3"),Yo=h("a"),Vo=d("References / Resources"),Ko=m(),Zo=h("ul"),Qo=h("li"),Xo=h("a"),ap=d("https://aws.amazon.com/blogs/opensource/rust-runtime-for-aws-lambda/"),np=m(),sp=h("li"),ep=h("a"),tp=d("https://github.com/srijs/rust-aws-lambda"),op=m(),pp=h("li"),cp=h("a"),rp=d("https://dev.to/adnanrahic/a-crash-course-on-serverless-with-aws—image-resize-on-the-fly-with-lambda-and-s3-4foo"),ip=m(),lp=h("li"),up=h("a"),hp=d("awslabs/aws-lambda-rust-runtime#29"),dp=m(),mp=h("li"),kp=h("a"),fp=d("https://docs.aws.amazon.com/AmazonS3/latest/dev/NotificationHowTo.html"),gp=m(),wp=h("li"),vp=h("a"),bp=d("https://hub.docker.com/r/softprops/lambda-rust/"),this.h()},l(a){n=k(a,"P",{});var t=f(n);s=g(t,"The very first iteration of my site didn’t have resized images and always showed the full 2200 pixels wide images, this was great on my local (desktop) machine, but when I tried visiting the site in a hotel in Cambodia, the site took ages to load."),t.forEach(w),e=v(a),c=k(a,"P",{});var p=f(c);u=g(p,"Resizing the images locally worked fine, but took a lot of time and uploading an image in five different sizes on slow Wi-Fi took ages, if it worked at all."),p.forEach(w),A=v(a),I=k(a,"P",{});var r=f(I);C=g(r,"I then switched to using an image resize proxy that took images from disk and re-sized them on the fly, caching the result in Nginx. This worked okay, but there was a tradeoff between server specs and monthly cost. Low specs meant that on an uncached page it took minutes before all images were resized, while high specs meant high monthly cost for a server that was idle 99% of the time."),r.forEach(w),P=v(a),L=k(a,"P",{});var i=f(L);_=g(i,"The solution to not running a server was switching to "),T=k(i,"A",{href:!0,rel:!0});var l=f(T);W=g(l,"imgix"),l.forEach(w),R=g(i,", it’s a great service that resizes images for you and does so with good quality and speed, but there’s a minimum fee of $10,00 a month, wether you use the service or not, and the costs go up pretty quickly as you add more and more photos. This is in addition to the S3 storage costs that imgix uses as the source for its proxy."),i.forEach(w),x=v(a),O=k(a,"P",{});var h=f(O);j=g(h,"This lead me to the latest solution, use S3 to store the images (imgix also requires s3 as a source, so the images were already there) and AWS Lambda to resize the images on upload."),h.forEach(w),$=v(a),D=k(a,"P",{});var d=f(D);N=g(d,"This means I only have to upload an image once and Lambda will take care of all the resized variants. I found a few (Javascript) solutions, and "),M=k(d,"A",{href:!0,rel:!0});var m=f(M);H=g(m,"aws-lambda-image"),m.forEach(w),q=g(d," looked the easiest to use. This ran for a few months, before I decided to roll my own solution for a few reasons."),d.forEach(w),F=v(a),G=k(a,"P",{});var b=f(G);J=g(b,"aws-lambda-image does a lot of magic and uses "),B=k(b,"A",{href:!0,rel:!0});var y=f(B);U=g(y,"Claudia"),y.forEach(w),Y=g(b," to manage the Lambda settings. While it works great, I don’t really like tools that require high-level access to AWS API’s and configure a lot for you automatically. I have no idea what’s happening after running the commands."),b.forEach(w),V=v(a),K=k(a,"P",{});var E=f(K);Z=g(E,"Another risk for me is that it Runs on Node, which eventually will require an upgrade at some point, which has a high risk of breaking the function and these things always happen at the most inconvenient times."),E.forEach(w),Q=v(a),X=k(a,"P",{});var S=f(X);aa=g(S,"What I wanted is a single binary that just keeps working and requires no upkeep, configured by myself so I know what’s happening and ideally more efficient than the NodeJS solution. It’s also a great excuse to play with Rust some more and the just released "),na=k(S,"A",{href:!0,rel:!0});var z=f(na);sa=g(z,"Rust AWS Lambda Runtime"),z.forEach(w),ea=g(S,"."),S.forEach(w),ta=v(a),oa=k(a,"H2",{id:!0});var yp=f(oa);pa=k(yp,"A",{href:!0});var Ep=f(pa);ca=g(Ep,"The goal"),Ep.forEach(w),yp.forEach(w),ra=v(a),ia=k(a,"P",{});var Sp=f(ia);la=g(Sp,"I wanted something similar to the Javascript solution used. It should listen to events emitted when a file is uploaded to S3 and resize the image in several widths ("),ua=k(Sp,"CODE",{});var Ap=f(ua);ha=g(Ap,"360px"),Ap.forEach(w),da=g(Sp,", "),ma=k(Sp,"CODE",{});var zp=f(ma);ka=g(zp,"720px"),zp.forEach(w),fa=g(Sp,", "),ga=k(Sp,"CODE",{});var Ip=f(ga);wa=g(Ip,"1200px"),Ip.forEach(w),va=g(Sp," and "),ba=k(Sp,"CODE",{});var Cp=f(ba);ya=g(Cp,"2200px"),Cp.forEach(w),Ea=g(Sp,")."),Sp.forEach(w),Sa=v(a),Aa=k(a,"P",{});var Pp=f(Aa);za=g(Pp,"Before we start, you can follow along with the complete source on "),Ia=k(Pp,"A",{href:!0,rel:!0});var Lp=f(Ia);Ca=g(Lp,"GitHub"),Lp.forEach(w),Pp.forEach(w),Pa=v(a),La=k(a,"H3",{id:!0});var _p=f(La);_a=k(_p,"A",{href:!0});var Tp=f(_a);Ta=g(Tp,"A binary project"),Tp.forEach(w),_p.forEach(w),Wa=v(a),Ra=k(a,"P",{});var Wp=f(Ra);xa=g(Wp,"Lets start by making a new Rust project, it should be a binary project and we need to make a few tweaks to the Cargo TOML to make sure Lambda can run the binary."),Wp.forEach(w),Oa=v(a),ja=k(a,"PRE",{class:!0}),f(ja).forEach(w),$a=v(a),Da=k(a,"P",{});var Rp=f(Da);Na=g(Rp,"The way AWS Lambda works is that it starts the app/binary for you and then you have to call a certain endpoint from the app to receive new jobs to process. The "),Ma=k(Rp,"CODE",{});var xp=f(Ma);Ha=g(xp,"lambda_runtime"),xp.forEach(w),qa=g(Rp," crate abstracts this process away and all you have to do is implement an event handler that will be called with the "),Fa=k(Rp,"CODE",{});var Op=f(Fa);Ga=g(Op,"lambda!"),Op.forEach(w),Ja=g(Rp," call."),Rp.forEach(w),Ba=v(a),Ua=k(a,"P",{});var jp=f(Ua);Ya=g(jp,"Cargo (heh) culting from the example app, we start a logger and run the lambda for the AWS Runtime."),jp.forEach(w),Va=v(a),Ka=k(a,"PRE",{class:!0}),f(Ka).forEach(w),Za=v(a),Qa=k(a,"P",{});var $p=f(Qa);Xa=g($p,"The "),an=k($p,"CODE",{});var Dp=f(an);nn=g(Dp,"handle_event"),Dp.forEach(w),sn=g($p," function will be called with the JSON result from the endpoint the runtime has called for us. Let’s convert this into a nice struct with Serde, by using the "),en=k($p,"A",{href:!0,rel:!0});var Np=f(en);tn=g(Np,"AWS-lambda-events crate"),Np.forEach(w),on=g($p,"."),$p.forEach(w),pn=v(a),cn=k(a,"H3",{id:!0});var Mp=f(cn);rn=k(Mp,"A",{href:!0});var Hp=f(rn);ln=g(Hp,"Handle S3 events"),Hp.forEach(w),Mp.forEach(w),un=v(a),hn=k(a,"P",{});var qp=f(hn);dn=g(qp,"This event contains one or more “records” that represent the S3 uploads it has received."),qp.forEach(w),mn=v(a),kn=k(a,"PRE",{class:!0}),f(kn).forEach(w),fn=v(a),gn=k(a,"P",{});var Fp=f(gn);wn=g(Fp,"For each upload we have to get the file from S3, convert the file to one or more image variations and upload those back to S3 again. There are a couple of crates that implement the S3 API, I went with "),vn=k(Fp,"A",{href:!0,rel:!0});var Gp=f(vn);bn=g(Gp,"rust-s3"),Gp.forEach(w),yn=g(Fp," as it looked simple and small."),Fp.forEach(w),En=v(a),Sn=k(a,"P",{});var Jp=f(Sn);An=g(Jp,"AWS Lambda sets a couple of "),zn=k(Jp,"A",{href:!0,rel:!0});var Bp=f(zn);In=g(Bp,"default ENV vars"),Bp.forEach(w),Cn=g(Jp,", among those it sets "),Pn=k(Jp,"CODE",{});var Up=f(Pn);Ln=g(Up,"AWS_ACCESS_KEY_ID"),Up.forEach(w),_n=g(Jp," and "),Tn=k(Jp,"CODE",{});var Yp=f(Tn);Wn=g(Yp,"AWS_SECRET_ACCESS_KEY"),Yp.forEach(w),Rn=g(Jp,", the "),xn=k(Jp,"CODE",{});var Vp=f(xn);On=g(Vp,"rust-s3"),Vp.forEach(w),jn=g(Jp," crate can detect those with the "),$n=k(Jp,"CODE",{});var Kp=f($n);Dn=g(Kp,"Credentials::default()"),Kp.forEach(w),Nn=g(Jp," function."),Jp.forEach(w),Mn=v(a),Hn=k(a,"P",{});var Zp=f(Hn);qn=g(Zp,"In my case I want to store the images in the same bucket as the source, just in a different location, so I can use the information from the S3 event to determine the region and bucket."),Zp.forEach(w),Fn=v(a),Gn=k(a,"PRE",{class:!0}),f(Gn).forEach(w),Jn=v(a),Bn=k(a,"H3",{id:!0});var Qp=f(Bn);Un=k(Qp,"A",{href:!0});var Xp=f(Un);Yn=g(Xp,"Recursion"),Xp.forEach(w),Qp.forEach(w),Vn=v(a),Kn=k(a,"P",{});var ac=f(Kn);Zn=g(ac,"Now that we have all the required configuration to get and store images on S3, we have to do a sanity check first. We listen to an S3 event for uploaded images, but this function also uploads images to S3, this means that if you make a mistake in the configuration, it could send out an S3 event for each file you put back into the bucket."),ac.forEach(w),Qn=v(a),Xn=k(a,"P",{});var nc=f(Xn);as=g(nc,"This can mean that you’ll process your own (resized) images again, and since we generate more than one variant for each uploaded image. Combined with the power of Lambda and it’s concurrency, it can mean that you’ll quickly generate thousands of new Lambda tasks, forcing you to hit the dreaded “panic button” in the Lambda UI, before you rack up an enormous AWS bill. (This "),ns=k(nc,"EM",{});var sc=f(ns);ss=g(sc,"may"),sc.forEach(w),es=g(nc," or may not come from my own experience ;))."),nc.forEach(w),ts=v(a),os=k(a,"P",{});var ec=f(os);ps=g(ec,"After resizing the image, we’ll append "),cs=k(ec,"CODE",{});var tc=f(cs);rs=g(tc,"-<size>"),tc.forEach(w),is=g(ec," to the filename (e.g. "),ls=k(ec,"CODE",{});var oc=f(ls);us=g(oc,"foo.jpg"),oc.forEach(w),hs=g(ec," becomes "),ds=k(ec,"CODE",{});var pc=f(ds);ms=g(pc,"foo-360.jpg"),pc.forEach(w),ks=g(ec,"). To prevent this Lambda recursion we check the uploaded filename to see if it was already resized."),ec.forEach(w),fs=v(a),gs=k(a,"PRE",{class:!0}),f(gs).forEach(w),ws=v(a),vs=k(a,"H3",{id:!0});var cc=f(vs);bs=k(cc,"A",{href:!0});var rc=f(bs);ys=g(rc,"Get images from- and upload to S3"),rc.forEach(w),cc.forEach(w),Es=v(a),Ss=k(a,"P",{});var ic=f(Ss);As=g(ic,"Now that we know for sure we have the right image, let’s fetch it from S3 and load it from memory into the "),zs=k(ic,"CODE",{});var lc=f(zs);Is=g(lc,"image"),lc.forEach(w),Cs=g(ic," crate."),ic.forEach(w),Ps=v(a),Ls=k(a,"PRE",{class:!0}),f(Ls).forEach(w),_s=v(a),Ts=k(a,"H3",{id:!0});var uc=f(Ts);Ws=k(uc,"A",{href:!0});var hc=f(Ws);Rs=g(hc,"Resize the images"),hc.forEach(w),uc.forEach(w),xs=v(a),Os=k(a,"P",{});var dc=f(Os);js=g(dc,"With the image in memory we can resize it. Depending on the memory you give a Lambda function, you can get one or more CPU cores to your disposal. To get the maximum from our billed execution time, I opted to use the great "),$s=k(dc,"A",{href:!0,rel:!0});var mc=f($s);Ds=g(mc,"rayon-rs"),mc.forEach(w),Ns=g(dc," crate to execute the resizes in parallel. All you have to do to process the image in parallel is to replace "),Ms=k(dc,"CODE",{});var kc=f(Ms);Hs=g(kc,"iter()"),kc.forEach(w),qs=g(dc," with "),Fs=k(dc,"CODE",{});var fc=f(Fs);Gs=g(fc,".par_iter()"),fc.forEach(w),Js=g(dc,", awesome!"),dc.forEach(w),Bs=v(a),Us=k(a,"PRE",{class:!0}),f(Us).forEach(w),Ys=v(a),Vs=k(a,"P",{});var gc=f(Vs);Ks=g(gc,"Another thing we do is loop through "),Zs=k(gc,"CODE",{});var wc=f(Zs);Qs=g(wc,"&config.replacemens"),wc.forEach(w),Xs=g(gc,", this is another feature to combat the recursion problem we have, by allowing us to replace certain parts of the (input) path of a file."),gc.forEach(w),ae=v(a),ne=k(a,"P",{});var vc=f(ne);se=g(vc,"We can set a "),ee=k(vc,"CODE",{});var bc=f(ee);te=g(bc,"REPLACEMENTS"),bc.forEach(w),oe=g(vc," env var with key/value strings, such as "),pe=k(vc,"CODE",{});var yc=f(pe);ce=g(yc,'"original:resized"'),yc.forEach(w),re=g(vc,"."),vc.forEach(w),ie=v(a),le=k(a,"P",{});var Ec=f(le);ue=g(Ec,"With an input path of "),he=k(Ec,"CODE",{});var Sc=f(he);de=g(Sc,"/original/trips/asia2018/img_01.jpg"),Sc.forEach(w),me=g(Ec," this will be converted to "),ke=k(Ec,"CODE",{});var Ac=f(ke);fe=g(Ac,"/resized/trips/asia2018/img_01.jpg"),Ac.forEach(w),ge=g(Ec,". Combined with the input filter on the AWS Lambda configure page you can make sure converted images are never processed twice."),Ec.forEach(w),we=v(a),ve=k(a,"P",{});var zc=f(ve);be=g(zc,"Finally we need to implement the actual resize function called in the code above."),zc.forEach(w),ye=v(a),Ee=k(a,"P",{});var Ic=f(Ee);Se=g(Ic,"it takes the image and a new width, calculates the ratio and generates the new needed height. We then call the image crate function and use the "),Ae=k(Ic,"CODE",{});var Cc=f(Ae);ze=g(Cc,"ImageOutputFormat::JPEG(90)"),Cc.forEach(w),Ie=g(Ic," ENUM to set the JPEG quality to "),Ce=k(Ic,"CODE",{});var Pc=f(Ce);Pe=g(Pc,"90"),Pc.forEach(w),Le=g(Ic," (from the default "),_e=k(Ic,"CODE",{});var Lc=f(_e);Te=g(Lc,"75"),Lc.forEach(w),We=g(Ic,")."),Ic.forEach(w),Re=v(a),xe=k(a,"PRE",{class:!0}),f(xe).forEach(w),Oe=v(a),je=k(a,"P",{});var _c=f(je);$e=g(_c,"You can find the complete project on "),De=k(_c,"A",{href:!0,rel:!0});var Tc=f(De);Ne=g(Tc,"GitHub"),Tc.forEach(w),Me=g(_c,"."),_c.forEach(w),He=v(a),qe=k(a,"H3",{id:!0});var Wc=f(qe);Fe=k(Wc,"A",{href:!0});var Rc=f(Fe);Ge=g(Rc,"Compiling for AWS Lambda"),Rc.forEach(w),Wc.forEach(w),Je=v(a),Be=k(a,"P",{});var xc=f(Be);Ue=g(xc,"With a working binary we now need to (cross)compile it for the right environment/distribution. Luckily a person named "),Ye=k(xc,"A",{href:!0,rel:!0});var Oc=f(Ye);Ve=g(Oc,"softprops"),Oc.forEach(w),Ke=g(xc," created a "),Ze=k(xc,"A",{href:!0,rel:!0});var jc=f(Ze);Qe=g(jc,"docker container"),jc.forEach(w),Xe=g(xc," that has all the tools we need to compile this binary to be used with the Lambda image."),xc.forEach(w),at=v(a),nt=k(a,"PRE",{class:!0}),f(nt).forEach(w),st=v(a),et=k(a,"P",{});var $c=f(et);tt=g($c,"This will generate a "),ot=k($c,"CODE",{});var Dc=f(ot);pt=g(Dc,"bootstrap.zip"),Dc.forEach(w),ct=g($c," file in "),rt=k($c,"CODE",{});var Nc=f(rt);it=g(Nc,"target/lambda/release"),Nc.forEach(w),lt=g($c,". You can also get the "),ut=k($c,"CODE",{});var Mc=f(ut);ht=g(Mc,"bootstrap.zip"),Mc.forEach(w),dt=g($c," from te "),mt=k($c,"A",{href:!0,rel:!0});var Hc=f(mt);kt=g(Hc,"releases page"),Hc.forEach(w),ft=g($c,"."),$c.forEach(w),gt=v(a),wt=k(a,"H3",{id:!0});var qc=f(wt);vt=k(qc,"A",{href:!0});var Fc=f(vt);bt=g(Fc,"Configuring Lambda"),Fc.forEach(w),qc.forEach(w),yt=v(a),Et=k(a,"P",{});var Gc=f(Et);St=g(Gc,"With a freshly compiled binary, we’re nearly there. We need to do two things, configure a IAM role that allows the Lambda function to write logs and has access to the S3 bucket and configure the Lambda function itself."),Gc.forEach(w),At=v(a),zt=k(a,"P",{});var Jc=f(zt);It=g(Jc,"Let’s start with the IAM Role, we’ll have to add two policies, one that allows the function to log and one that allows access to S3, it should look something like:"),Jc.forEach(w),Ct=v(a),o(Pt.$$.fragment,a),Lt=v(a),_t=k(a,"P",{});var Bc=f(_t);Tt=g(Bc,"Bonus points if you lock the S3 role down a bit more, by not allowing it to remove items."),Bc.forEach(w),Wt=v(a),Rt=k(a,"P",{});var Uc=f(Rt);xt=g(Uc,"With a role configured, we can configure the lambda function, we have to set the "),Ot=k(Uc,"CODE",{});var Yc=f(Ot);jt=g(Yc,"SIZES"),Yc.forEach(w),$t=g(Uc," and "),Dt=k(Uc,"CODE",{});var Vc=f(Dt);Nt=g(Vc,"REPLACEMENTS"),Vc.forEach(w),Mt=g(Uc," ENV vars and I found that the function works best with at least "),Ht=k(Uc,"CODE",{});var Kc=f(Ht);qt=g(Kc,"1024MB"),Kc.forEach(w),Ft=g(Uc," of memory assigned."),Uc.forEach(w),Gt=v(a),o(Jt.$$.fragment,a),Bt=v(a),Ut=k(a,"P",{});var Zc=f(Ut);Yt=g(Zc,"Attach the generated "),Vt=k(Zc,"CODE",{});var Qc=f(Vt);Kt=g(Qc,"bootstrap.zip"),Qc.forEach(w),Zt=g(Zc," file and save the function."),Zc.forEach(w),Qt=v(a),Xt=k(a,"P",{});var Xc=f(Xt);ao=g(Xc,"Finally we need to configure the S3 events, pick “S3” events from the “Add triggers” section on the page and pick the option that says “All upload events”. I’ve also set the prefix/suffix option to prevent our recursion problem."),Xc.forEach(w),no=v(a),o(so.$$.fragment,a),eo=v(a),to=k(a,"P",{});var ar=f(to);oo=g(ar,"Save the function again and upload an image to test, if everything went well, it should generate resized images after the upload is complete. You can verify it works (or catch any errors) on AWS Cloudwatch, it should look something like this:"),ar.forEach(w),po=v(a),co=k(a,"PRE",{class:!0}),f(co).forEach(w),ro=v(a),io=k(a,"H2",{id:!0});var nr=f(io);lo=k(nr,"A",{href:!0});var sr=f(lo);uo=g(sr,"Future goals"),sr.forEach(w),nr.forEach(w),ho=v(a),mo=k(a,"P",{});var er=f(mo);ko=g(er,"You can find the source on "),fo=k(er,"A",{href:!0,rel:!0});var tr=f(fo);go=g(tr,"GitHub"),tr.forEach(w),wo=g(er," and a ready-to-go "),vo=k(er,"CODE",{});var or=f(vo);bo=g(or,"bootstrap.zip"),or.forEach(w),yo=g(er," on the "),Eo=k(er,"A",{href:!0,rel:!0});var pr=f(Eo);So=g(pr,"relase page"),pr.forEach(w),Ao=g(er,"."),er.forEach(w),zo=v(a),Io=k(a,"P",{});var cr=f(Io);Co=g(cr,"The binary works great and has resized many images already. With Amazon’s generous free Lambda tier, resizing all the images on my blog has cost me a grand total of "),Po=k(cr,"STRONG",{});var rr=f(Po);Lo=g(rr,"$0.61"),rr.forEach(w),_o=g(cr,". There is room for improvement, however. Error handling can be a lot nicer than "),To=k(cr,"CODE",{});var ir=f(To);Wo=g(ir,".expect()"),ir.forEach(w),Ro=g(cr," everywhere, though as long as it logs the error in CloudWatch it works for me right now."),cr.forEach(w),xo=v(a),Oo=k(a,"P",{});var lr=f(Oo);jo=g(lr,"It would be nice if it could handle more image formats, while the "),$o=k(lr,"CODE",{});var ur=f($o);Do=g(ur,"image"),ur.forEach(w),No=g(lr," crate works fine with input formats such as GIF, JPEG, PNG and WEBP, right now I only generate JPEG images. I like it to generate WEBP images along side the JPEGs but I couldn’t find any crate that can generate WEBP images. If you happen to know one or have other feedback on this post, please let me know "),Mo=k(lr,"A",{href:!0});var hr=f(Mo);Ho=g(hr,"by email"),hr.forEach(w),qo=g(lr," or "),Fo=k(lr,"A",{href:!0,rel:!0});var dr=f(Fo);Go=g(dr,"tweet me"),dr.forEach(w),Jo=g(lr,"."),lr.forEach(w),Bo=v(a),Uo=k(a,"H3",{id:!0});var mr=f(Uo);Yo=k(mr,"A",{href:!0});var kr=f(Yo);Vo=g(kr,"References / Resources"),kr.forEach(w),mr.forEach(w),Ko=v(a),Zo=k(a,"UL",{});var fr=f(Zo);Qo=k(fr,"LI",{});var gr=f(Qo);Xo=k(gr,"A",{href:!0,rel:!0});var wr=f(Xo);ap=g(wr,"https://aws.amazon.com/blogs/opensource/rust-runtime-for-aws-lambda/"),wr.forEach(w),gr.forEach(w),np=v(fr),sp=k(fr,"LI",{});var vr=f(sp);ep=k(vr,"A",{href:!0,rel:!0});var br=f(ep);tp=g(br,"https://github.com/srijs/rust-aws-lambda"),br.forEach(w),vr.forEach(w),op=v(fr),pp=k(fr,"LI",{});var yr=f(pp);cp=k(yr,"A",{href:!0,rel:!0});var Er=f(cp);rp=g(Er,"https://dev.to/adnanrahic/a-crash-course-on-serverless-with-aws—image-resize-on-the-fly-with-lambda-and-s3-4foo"),Er.forEach(w),yr.forEach(w),ip=v(fr),lp=k(fr,"LI",{});var Sr=f(lp);up=k(Sr,"A",{href:!0,rel:!0});var Ar=f(up);hp=g(Ar,"awslabs/aws-lambda-rust-runtime#29"),Ar.forEach(w),Sr.forEach(w),dp=v(fr),mp=k(fr,"LI",{});var zr=f(mp);kp=k(zr,"A",{href:!0,rel:!0});var Ir=f(kp);fp=g(Ir,"https://docs.aws.amazon.com/AmazonS3/latest/dev/NotificationHowTo.html"),Ir.forEach(w),zr.forEach(w),gp=v(fr),wp=k(fr,"LI",{});var Cr=f(wp);vp=k(Cr,"A",{href:!0,rel:!0});var Pr=f(vp);bp=g(Pr,"https://hub.docker.com/r/softprops/lambda-rust/"),Pr.forEach(w),Cr.forEach(w),fr.forEach(w),this.h()},h(){b(T,"href","https://imgix.com"),b(T,"rel","nofollow"),b(M,"href","https://github.com/ysugimoto/aws-lambda-image"),b(M,"rel","nofollow"),b(B,"href","https://claudiajs.com/"),b(B,"rel","nofollow"),b(na,"href","https://github.com/awslabs/aws-lambda-rust-runtime"),b(na,"rel","nofollow"),b(pa,"href","#the-goal"),b(oa,"id","the-goal"),b(Ia,"href","https://github.com/matsimitsu/lambda-image-resize-rust/"),b(Ia,"rel","nofollow"),b(_a,"href","#a-binary-project"),b(La,"id","a-binary-project"),b(ja,"class","language-toml"),b(Ka,"class","language-rust"),b(en,"href","https://github.com/LegNeato/aws-lambda-events/blob/master/aws_lambda_events/src/generated/s3.rs"),b(en,"rel","nofollow"),b(rn,"href","#handle-s3-events"),b(cn,"id","handle-s3-events"),b(kn,"class","language-rust"),b(vn,"href","https://github.com/durch/rust-s3"),b(vn,"rel","nofollow"),b(zn,"href","https://docs.aws.amazon.com/lambda/latest/dg/current-supported-versions.html"),b(zn,"rel","nofollow"),b(Gn,"class","language-rust"),b(Un,"href","#recursion"),b(Bn,"id","recursion"),b(gs,"class","language-rust"),b(bs,"href","#get-images-from--and-upload-to-s3"),b(vs,"id","get-images-from--and-upload-to-s3"),b(Ls,"class","language-rust"),b(Ws,"href","#resize-the-images"),b(Ts,"id","resize-the-images"),b($s,"href","https://github.com/rayon-rs/rayon"),b($s,"rel","nofollow"),b(Us,"class","language-rust"),b(xe,"class","language-rust"),b(De,"href","https://github.com/matsimitsu/lambda-image-resize-rust"),b(De,"rel","nofollow"),b(Fe,"href","#compiling-for-aws-lambda"),b(qe,"id","compiling-for-aws-lambda"),b(Ye,"href","https://hub.docker.com/u/softprops"),b(Ye,"rel","nofollow"),b(Ze,"href","https://hub.docker.com/r/softprops/lambda-rust/"),b(Ze,"rel","nofollow"),b(nt,"class","language-bash"),b(mt,"href","https://github.com/matsimitsu/lambda-image-resize-rust/releases"),b(mt,"rel","nofollow"),b(vt,"href","#configuring-lambda"),b(wt,"id","configuring-lambda"),b(co,"class","language-null"),b(lo,"href","#future-goals"),b(io,"id","future-goals"),b(fo,"href","https://github.com/matsimitsu/lambda-image-resize-rust"),b(fo,"rel","nofollow"),b(Eo,"href","https://github.com/matsimitsu/lambda-image-resize-rust/releases"),b(Eo,"rel","nofollow"),b(Mo,"href","mailto:hello@matsimitsu.nl"),b(Fo,"href","https://twitter.com/matsimitsu"),b(Fo,"rel","nofollow"),b(Yo,"href","#references--resources"),b(Uo,"id","references--resources"),b(Xo,"href","https://aws.amazon.com/blogs/opensource/rust-runtime-for-aws-lambda/"),b(Xo,"rel","nofollow"),b(ep,"href","https://github.com/srijs/rust-aws-lambda"),b(ep,"rel","nofollow"),b(cp,"href","https://dev.to/adnanrahic/a-crash-course-on-serverless-with-aws---image-resize-on-the-fly-with-lambda-and-s3-4foo"),b(cp,"rel","nofollow"),b(up,"href","https://github.com/awslabs/aws-lambda-rust-runtime/issues/29"),b(up,"rel","nofollow"),b(kp,"href","https://docs.aws.amazon.com/AmazonS3/latest/dev/NotificationHowTo.html"),b(kp,"rel","nofollow"),b(vp,"href","https://hub.docker.com/r/softprops/lambda-rust/"),b(vp,"rel","nofollow")},m(a,t){y(a,n,t),E(n,s),y(a,e,t),y(a,c,t),E(c,u),y(a,A,t),y(a,I,t),E(I,C),y(a,P,t),y(a,L,t),E(L,_),E(L,T),E(T,W),E(L,R),y(a,x,t),y(a,O,t),E(O,j),y(a,$,t),y(a,D,t),E(D,N),E(D,M),E(M,H),E(D,q),y(a,F,t),y(a,G,t),E(G,J),E(G,B),E(B,U),E(G,Y),y(a,V,t),y(a,K,t),E(K,Z),y(a,Q,t),y(a,X,t),E(X,aa),E(X,na),E(na,sa),E(X,ea),y(a,ta,t),y(a,oa,t),E(oa,pa),E(pa,ca),y(a,ra,t),y(a,ia,t),E(ia,la),E(ia,ua),E(ua,ha),E(ia,da),E(ia,ma),E(ma,ka),E(ia,fa),E(ia,ga),E(ga,wa),E(ia,va),E(ia,ba),E(ba,ya),E(ia,Ea),y(a,Sa,t),y(a,Aa,t),E(Aa,za),E(Aa,Ia),E(Ia,Ca),y(a,Pa,t),y(a,La,t),E(La,_a),E(_a,Ta),y(a,Wa,t),y(a,Ra,t),E(Ra,xa),y(a,Oa,t),y(a,ja,t),ja.innerHTML='<code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">package</span><span class="token punctuation">]</span>\n<span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"lambda-image-resize-rust"</span>\n<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"0.1.0"</span>\n<span class="token key property">authors</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"Robert Beekman &lt;robert@matsimitsu.nl>"</span><span class="token punctuation">]</span>\n\n<span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span>\n<span class="token key property">lambda_runtime</span> <span class="token punctuation">=</span> <span class="token string">"0.1"</span>\n\n<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">bin</span><span class="token punctuation">]</span><span class="token punctuation">]</span>\n<span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"bootstrap"</span>\n<span class="token key property">path</span> <span class="token punctuation">=</span> <span class="token string">"src/main.rs"</span></code>',y(a,$a,t),y(a,Da,t),E(Da,Na),E(Da,Ma),E(Ma,Ha),E(Da,qa),E(Da,Fa),E(Fa,Ga),E(Da,Ja),y(a,Ba,t),y(a,Ua,t),E(Ua,Ya),y(a,Va,t),y(a,Ka,t),Ka.innerHTML='<code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">Error</span><span class="token operator">>></span> <span class="token punctuation">&#123;</span>\n    <span class="token namespace">simple_logger<span class="token punctuation">::</span></span><span class="token function">init_with_level</span><span class="token punctuation">(</span><span class="token namespace">log<span class="token punctuation">::</span></span><span class="token class-name">Level</span><span class="token punctuation">::</span><span class="token class-name">Info</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>\n\n    <span class="token macro property">lambda!</span><span class="token punctuation">(</span>handle_event<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">&#125;</span></code>',y(a,Za,t),y(a,Qa,t),E(Qa,Xa),E(Qa,an),E(an,nn),E(Qa,sn),E(Qa,en),E(en,tn),E(Qa,on),y(a,pn,t),y(a,cn,t),E(cn,rn),E(rn,ln),y(a,un,t),y(a,hn,t),E(hn,dn),y(a,mn,t),y(a,kn,t),kn.innerHTML='<code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">handle_event</span><span class="token punctuation">(</span>event<span class="token punctuation">:</span> <span class="token class-name">Value</span><span class="token punctuation">,</span> ctx<span class="token punctuation">:</span> <span class="token namespace">lambda<span class="token punctuation">::</span></span><span class="token class-name">Context</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">HandlerError</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">let</span> config <span class="token operator">=</span> <span class="token class-name">Config</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> s3_event<span class="token punctuation">:</span> <span class="token class-name">S3Event</span> <span class="token operator">=</span>\n        <span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token function">from_value</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>e<span class="token closure-punctuation punctuation">|</span></span> ctx<span class="token punctuation">.</span><span class="token function">new_error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> record <span class="token keyword">in</span> s3_event<span class="token punctuation">.</span>records <span class="token punctuation">&#123;</span>\n        <span class="token function">handle_record</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>config<span class="token punctuation">,</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">&#125;</span>\n    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">&#125;</span></code>',y(a,fn,t),y(a,gn,t),E(gn,wn),E(gn,vn),E(vn,bn),E(gn,yn),y(a,En,t),y(a,Sn,t),E(Sn,An),E(Sn,zn),E(zn,In),E(Sn,Cn),E(Sn,Pn),E(Pn,Ln),E(Sn,_n),E(Sn,Tn),E(Tn,Wn),E(Sn,Rn),E(Sn,xn),E(xn,On),E(Sn,jn),E(Sn,$n),E($n,Dn),E(Sn,Nn),y(a,Mn,t),y(a,Hn,t),E(Hn,qn),y(a,Fn,t),y(a,Gn,t),Gn.innerHTML='<code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">handle_record</span><span class="token punctuation">(</span>config<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Config</span><span class="token punctuation">,</span> record<span class="token punctuation">:</span> <span class="token class-name">S3EventRecord</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">let</span> credentials <span class="token operator">=</span> <span class="token class-name">Credentials</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> region<span class="token punctuation">:</span> <span class="token class-name">Region</span> <span class="token operator">=</span> record\n        <span class="token punctuation">.</span>aws_region\n        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Could not get region from record"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Could not parse region from record"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> bucket <span class="token operator">=</span> <span class="token class-name">Bucket</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>\n        <span class="token operator">&amp;</span>record\n            <span class="token punctuation">.</span>s3\n            <span class="token punctuation">.</span>bucket\n            <span class="token punctuation">.</span>name\n            <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Could not get bucket name from record"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        region<span class="token punctuation">,</span>\n        credentials<span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> source <span class="token operator">=</span> record\n        <span class="token punctuation">.</span>s3\n        <span class="token punctuation">.</span>object\n        <span class="token punctuation">.</span>key\n        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Could not get key from object record"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">&#125;</span></code>',y(a,Jn,t),y(a,Bn,t),E(Bn,Un),E(Un,Yn),y(a,Vn,t),y(a,Kn,t),E(Kn,Zn),y(a,Qn,t),y(a,Xn,t),E(Xn,as),E(Xn,ns),E(ns,ss),E(Xn,es),y(a,ts,t),y(a,os,t),E(os,ps),E(os,cs),E(cs,rs),E(os,is),E(os,ls),E(ls,us),E(os,hs),E(os,ds),E(ds,ms),E(os,ks),y(a,fs,t),y(a,gs,t),gs.innerHTML='<code class="language-rust">    <span class="token comment">/* Make sure we don\'t process files twice */</span>\n    <span class="token keyword">for</span> size <span class="token keyword">in</span> <span class="token operator">&amp;</span>config<span class="token punctuation">.</span>sizes <span class="token punctuation">&#123;</span>\n        <span class="token keyword">let</span> to_match <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"-&#123;&#125;.jpg"</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> source<span class="token punctuation">.</span><span class="token function">ends_with</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>to_match<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>\n            <span class="token macro property">warn!</span><span class="token punctuation">(</span>\n                <span class="token string">"Source: \'&#123;&#125;\' ends with: \'&#123;&#125;\'. Skipping."</span><span class="token punctuation">,</span>\n                <span class="token operator">&amp;</span>source<span class="token punctuation">,</span>\n                <span class="token operator">&amp;</span>to_match\n            <span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">return</span><span class="token punctuation">;</span>\n        <span class="token punctuation">&#125;</span>\n    <span class="token punctuation">&#125;</span></code>',y(a,ws,t),y(a,vs,t),E(vs,bs),E(bs,ys),y(a,Es,t),y(a,Ss,t),E(Ss,As),E(Ss,zs),E(zs,Is),E(Ss,Cs),y(a,Ps,t),y(a,Ls,t),Ls.innerHTML='<code class="language-rust">    <span class="token keyword">let</span> <span class="token punctuation">(</span>data<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=</span> bucket\n        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>source<span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"Could not get object: &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> img <span class="token operator">=</span> <span class="token namespace">image<span class="token punctuation">::</span></span><span class="token function">load_from_memory</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>data<span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Opening image failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>',y(a,_s,t),y(a,Ts,t),E(Ts,Ws),E(Ws,Rs),y(a,xs,t),y(a,Os,t),E(Os,js),E(Os,$s),E($s,Ds),E(Os,Ns),E(Os,Ms),E(Ms,Hs),E(Os,qs),E(Os,Fs),E(Fs,Gs),E(Os,Js),y(a,Bs,t),y(a,Us,t),Us.innerHTML='<code class="language-rust">    <span class="token keyword">let</span> _<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span>_<span class="token operator">></span> <span class="token operator">=</span> config\n        <span class="token punctuation">.</span>sizes\n        <span class="token punctuation">.</span><span class="token function">par_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>size<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>\n            <span class="token keyword">let</span> buffer <span class="token operator">=</span> <span class="token function">resize_image</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>img<span class="token punctuation">,</span> <span class="token operator">&amp;</span>size<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"Could not resize image"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n            <span class="token keyword">let</span> <span class="token keyword">mut</span> target <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">for</span> <span class="token punctuation">(</span>rep_key<span class="token punctuation">,</span> rep_val<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token operator">&amp;</span>config<span class="token punctuation">.</span>replacements <span class="token punctuation">&#123;</span>\n                target <span class="token operator">=</span> target<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>rep_key<span class="token punctuation">,</span> rep_val<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">&#125;</span>\n            target <span class="token operator">=</span> target<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">".jpg"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"-&#123;&#125;.jpg"</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">let</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> code<span class="token punctuation">)</span> <span class="token operator">=</span> bucket\n                <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>target<span class="token punctuation">,</span> <span class="token operator">&amp;</span>buffer<span class="token punctuation">,</span> <span class="token string">"image/jpeg"</span><span class="token punctuation">)</span>\n                <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"Could not upload object to :&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"Uploaded: &#123;&#125; with: &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>target<span class="token punctuation">,</span> <span class="token operator">&amp;</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>',y(a,Ys,t),y(a,Vs,t),E(Vs,Ks),E(Vs,Zs),E(Zs,Qs),E(Vs,Xs),y(a,ae,t),y(a,ne,t),E(ne,se),E(ne,ee),E(ee,te),E(ne,oe),E(ne,pe),E(pe,ce),E(ne,re),y(a,ie,t),y(a,le,t),E(le,ue),E(le,he),E(he,de),E(le,me),E(le,ke),E(ke,fe),E(le,ge),y(a,we,t),y(a,ve,t),E(ve,be),y(a,ye,t),y(a,Ee,t),E(Ee,Se),E(Ee,Ae),E(Ae,ze),E(Ee,Ie),E(Ee,Ce),E(Ce,Pe),E(Ee,Le),E(Ee,_e),E(_e,Te),E(Ee,We),y(a,Re,t),y(a,xe,t),xe.innerHTML='<code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">resize_image</span><span class="token punctuation">(</span>img<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token namespace">image<span class="token punctuation">::</span></span><span class="token class-name">DynamicImage</span><span class="token punctuation">,</span> new_w<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">f32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token class-name">ImageError</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> result<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> old_w <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">f32</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> old_h <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">f32</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> ratio <span class="token operator">=</span> new_w <span class="token operator">/</span> old_w<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> new_h <span class="token operator">=</span> <span class="token punctuation">(</span>old_h <span class="token operator">*</span> ratio<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> scaled <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token operator">*</span>new_w <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">,</span> new_h <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token namespace">image<span class="token punctuation">::</span></span><span class="token class-name">FilterType</span><span class="token punctuation">::</span><span class="token class-name">Lanczos3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    scaled<span class="token punctuation">.</span><span class="token function">write_to</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> result<span class="token punctuation">,</span> <span class="token class-name">ImageOutputFormat</span><span class="token punctuation">::</span><span class="token constant">JPEG</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>\n\n    <span class="token class-name">Ok</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>\n<span class="token punctuation">&#125;</span></code>',y(a,Oe,t),y(a,je,t),E(je,$e),E(je,De),E(De,Ne),E(je,Me),y(a,He,t),y(a,qe,t),E(qe,Fe),E(Fe,Ge),y(a,Je,t),y(a,Be,t),E(Be,Ue),E(Be,Ye),E(Ye,Ve),E(Be,Ke),E(Be,Ze),E(Ze,Qe),E(Be,Xe),y(a,at,t),y(a,nt,t),nt.innerHTML='<code class="language-bash">\tdocker run --rm <span class="token punctuation"></span>\n\t\t-v <span class="token variable">$&#123;<span class="token environment constant">PWD</span>&#125;</span>:/code <span class="token punctuation"></span>\n\t\t-v <span class="token variable">$&#123;<span class="token environment constant">HOME</span>&#125;</span>/.cargo/registry:/root/.cargo/registry <span class="token punctuation"></span>\n\t\t-v <span class="token variable">$&#123;<span class="token environment constant">HOME</span>&#125;</span>/.cargo/git:/root/.cargo/git <span class="token punctuation"></span>\n\t\tsoftprops/lambda-rust</code>',y(a,st,t),y(a,et,t),E(et,tt),E(et,ot),E(ot,pt),E(et,ct),E(et,rt),E(rt,it),E(et,lt),E(et,ut),E(ut,ht),E(et,dt),E(et,mt),E(mt,kt),E(et,ft),y(a,gt,t),y(a,wt,t),E(wt,vt),E(vt,bt),y(a,yt,t),y(a,Et,t),E(Et,St),y(a,At,t),y(a,zt,t),E(zt,It),y(a,Ct,t),p(Pt,a,t),y(a,Lt,t),y(a,_t,t),E(_t,Tt),y(a,Wt,t),y(a,Rt,t),E(Rt,xt),E(Rt,Ot),E(Ot,jt),E(Rt,$t),E(Rt,Dt),E(Dt,Nt),E(Rt,Mt),E(Rt,Ht),E(Ht,qt),E(Rt,Ft),y(a,Gt,t),p(Jt,a,t),y(a,Bt,t),y(a,Ut,t),E(Ut,Yt),E(Ut,Vt),E(Vt,Kt),E(Ut,Zt),y(a,Qt,t),y(a,Xt,t),E(Xt,ao),y(a,no,t),p(so,a,t),y(a,eo,t),y(a,to,t),E(to,oo),y(a,po,t),y(a,co,t),co.innerHTML='<code class="language-null">START RequestId: 7e7886d6-f983-4ef7-9916-83ab53874c6c Version: $LATEST\n2019-03-09 15:07:35 INFO [lambda_runtime::runtime] Received new event with AWS request id: 7e7886d6-f983-4ef7-9916-83ab53874c6c\n2019-03-09 15:07:35 INFO [bootstrap] Fetching: original-rust/blog/image-resize-rust/lambda-config.jpg, config: Config &#123; sizes: [360.0, 720.0, 1200.0, 2200.0], replacements: [(&quot;original-rust&quot;, &quot;r&quot;), (&quot;original&quot;, &quot;r&quot;)] &#125;\n2019-03-09 15:07:36 INFO [bootstrap] Uploaded: r/blog/image-resize-rust/lambda-config-360.jpg with: 200\n2019-03-09 15:07:36 INFO [bootstrap] Uploaded: r/blog/image-resize-rust/lambda-config-1200.jpg with: 200\n2019-03-09 15:07:36 INFO [bootstrap] Uploaded: r/blog/image-resize-rust/lambda-config-720.jpg with: 200\n2019-03-09 15:07:38 INFO [bootstrap] Uploaded: r/blog/image-resize-rust/lambda-config-2200.jpg with: 200\n2019-03-09 15:07:38 INFO [lambda_runtime::runtime] Response for 7e7886d6-f983-4ef7-9916-83ab53874c6c accepted by Runtime API\nEND RequestId: 7e7886d6-f983-4ef7-9916-83ab53874c6c\nREPORT RequestId: 7e7886d6-f983-4ef7-9916-83ab53874c6c\tInit Duration: 86.53 ms\tDuration: 2944.40 ms\tBilled Duration: 3100 ms Memory Size: 1024 MB\tMax Memory Used: 125 MB</code>',y(a,ro,t),y(a,io,t),E(io,lo),E(lo,uo),y(a,ho,t),y(a,mo,t),E(mo,ko),E(mo,fo),E(fo,go),E(mo,wo),E(mo,vo),E(vo,bo),E(mo,yo),E(mo,Eo),E(Eo,So),E(mo,Ao),y(a,zo,t),y(a,Io,t),E(Io,Co),E(Io,Po),E(Po,Lo),E(Io,_o),E(Io,To),E(To,Wo),E(Io,Ro),y(a,xo,t),y(a,Oo,t),E(Oo,jo),E(Oo,$o),E($o,Do),E(Oo,No),E(Oo,Mo),E(Mo,Ho),E(Oo,qo),E(Oo,Fo),E(Fo,Go),E(Oo,Jo),y(a,Bo,t),y(a,Uo,t),E(Uo,Yo),E(Yo,Vo),y(a,Ko,t),y(a,Zo,t),E(Zo,Qo),E(Qo,Xo),E(Xo,ap),E(Zo,np),E(Zo,sp),E(sp,ep),E(ep,tp),E(Zo,op),E(Zo,pp),E(pp,cp),E(cp,rp),E(Zo,ip),E(Zo,lp),E(lp,up),E(up,hp),E(Zo,dp),E(Zo,mp),E(mp,kp),E(kp,fp),E(Zo,gp),E(Zo,wp),E(wp,vp),E(vp,bp),yp=!0},p:S,i(a){yp||(r(Pt.$$.fragment,a),r(Jt.$$.fragment,a),r(so.$$.fragment,a),yp=!0)},o(a){i(Pt.$$.fragment,a),i(Jt.$$.fragment,a),i(so.$$.fragment,a),yp=!1},d(a){a&&w(n),a&&w(e),a&&w(c),a&&w(A),a&&w(I),a&&w(P),a&&w(L),a&&w(x),a&&w(O),a&&w($),a&&w(D),a&&w(F),a&&w(G),a&&w(V),a&&w(K),a&&w(Q),a&&w(X),a&&w(ta),a&&w(oa),a&&w(ra),a&&w(ia),a&&w(Sa),a&&w(Aa),a&&w(Pa),a&&w(La),a&&w(Wa),a&&w(Ra),a&&w(Oa),a&&w(ja),a&&w($a),a&&w(Da),a&&w(Ba),a&&w(Ua),a&&w(Va),a&&w(Ka),a&&w(Za),a&&w(Qa),a&&w(pn),a&&w(cn),a&&w(un),a&&w(hn),a&&w(mn),a&&w(kn),a&&w(fn),a&&w(gn),a&&w(En),a&&w(Sn),a&&w(Mn),a&&w(Hn),a&&w(Fn),a&&w(Gn),a&&w(Jn),a&&w(Bn),a&&w(Vn),a&&w(Kn),a&&w(Qn),a&&w(Xn),a&&w(ts),a&&w(os),a&&w(fs),a&&w(gs),a&&w(ws),a&&w(vs),a&&w(Es),a&&w(Ss),a&&w(Ps),a&&w(Ls),a&&w(_s),a&&w(Ts),a&&w(xs),a&&w(Os),a&&w(Bs),a&&w(Us),a&&w(Ys),a&&w(Vs),a&&w(ae),a&&w(ne),a&&w(ie),a&&w(le),a&&w(we),a&&w(ve),a&&w(ye),a&&w(Ee),a&&w(Re),a&&w(xe),a&&w(Oe),a&&w(je),a&&w(He),a&&w(qe),a&&w(Je),a&&w(Be),a&&w(at),a&&w(nt),a&&w(st),a&&w(et),a&&w(gt),a&&w(wt),a&&w(yt),a&&w(Et),a&&w(At),a&&w(zt),a&&w(Ct),l(Pt,a),a&&w(Lt),a&&w(_t),a&&w(Wt),a&&w(Rt),a&&w(Gt),l(Jt,a),a&&w(Bt),a&&w(Ut),a&&w(Qt),a&&w(Xt),a&&w(no),l(so,a),a&&w(eo),a&&w(to),a&&w(po),a&&w(co),a&&w(ro),a&&w(io),a&&w(ho),a&&w(mo),a&&w(zo),a&&w(Io),a&&w(xo),a&&w(Oo),a&&w(Bo),a&&w(Uo),a&&w(Ko),a&&w(Zo)}}}function C(a){let n,s;const h=[P];let d={$$slots:{default:[I]},$$scope:{ctx:a}};for(let t=0;t<h.length;t+=1)d=e(d,h[t]);return n=new A({props:d}),{c(){t(n.$$.fragment)},l(a){o(n.$$.fragment,a)},m(a,e){p(n,a,e),s=!0},p(a,[s]){const e=0&s?c(h,[u(P)]):{};1&s&&(e.$$scope={dirty:s,ctx:a}),n.$set(e)},i(a){s||(r(n.$$.fragment,a),s=!0)},o(a){i(n.$$.fragment,a),s=!1},d(a){l(n,a)}}}const P={title:"Resize images from s3 with AWS Lambda and Rust",date:"2019-03-09T00:00:00.000Z",tags:null,summary:"My site contains a lot of images and resizing them for different devices (mobile phone, tabled, desktop etc.) takes a lot of time and (upload) bandwidth. This is especially annoying on Hotel Wi-Fi in a far-away country. With the help of AWS Lambda and Rust I made this into a smooth process."};export default class extends a{constructor(a){super(),n(this,a,null,C,s,{})}}export{P as metadata};
